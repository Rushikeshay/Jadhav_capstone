<h1>Day Details</h1>

<div style="margin-bottom: 20px;">
  <a href="/trips/<%= @the_day.trip_id %>">‚Üê Back to Trip</a> | 
  <a href="/delete_day/<%= @the_day.id %>" style="color: red;">Delete this Day</a>
</div>

<div style="display: flex; gap: 40px;">
  <section style="flex: 2;">
    <h2>Activities</h2>
    <% if @the_day.activities.any? %>
      <ul>
        <% @the_day.activities.each do |activity| %>
          <li style="margin-bottom: 15px;">
            <strong><%= activity.name %></strong>

            <% if activity.picture.present? %>
              <div style="margin-top: 5px;">
                <img src="<%= activity.picture_url %>" style="width: 200px; border-radius: 8px; display: block;">
              </div>
            <% end %>

            <% if activity.notes.present? %>
              <p><small><%= activity.notes %></small></p>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No activities added yet.</p>
    <% end %>
    <hr>
    <h3>Add a new activity</h3>
    <form action="/insert_activity" method="post" enctype="multipart/form-data">
      <input type="hidden" name="query_day_id" value="<%= @the_day.id %>">

      <div style="margin-bottom: 10px;">
        <label for="name_box">Activity Name</label><br>
        <input type="text" id="name_box" name="query_name" placeholder="e.g. Eiffel Tower Visit" required>
      </div>

      <div>
        <label for="picture_box">Upload Picture</label><br>
        <input type="file" id="picture_box" name="query_picture">
      </div>

      <button>Add Activity</button>

      <div style="margin-bottom: 10px;">
        <label for="address_box">Address/Location</label><br>
        <input type="text" id="address_box" name="query_address" placeholder="123 Street Name">
      </div>

      <div style="margin-bottom: 10px;">
        <label for="notes_box">Notes</label><br>
        <textarea id="notes_box" name="query_notes" rows="3" placeholder="Don't forget the tickets!"></textarea>
      </div>

      <button style="background-color: #2ea44f; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
        Add Activity
      </button>
    </form>
  </section>

  <section style="flex: 1; border-left: 1px solid #ccc; padding-left: 20px;">
    <h3>Map</h3>

    <% 
      map_markers = @the_day.activities.map do |activity|
        { 
          title: activity.name, 
          lat: activity.latitude, 
          lng: activity.longitude 
        }
      end 
    %>

    <div 
      data-controller="google-map" 
      data-google-map-markers-value="<%= map_markers.to_json %>"
      style="height: 400px; width: 100%; border-radius: 8px;"
    ></div>

    <p style="margin-top: 20px; font-size: 0.8em; color: gray;">
      Showing locations for <%= pluralize(@the_day.activities.count, "activity") %>
    </p>
  </section>
</div>
